<div>
  <div class="row">
    <div class="col">
      <div id="description">
        <div class="section-head">
          Hangman
        </div>
        <div class="section-body">
          Hangman is a paper and pencil guessing game for two or more players. One player thinks of a word, phrase or sentence and the other(s) tries to guess it by suggesting letters before the man is "hanged".
        </div>
      </div>
      <div class="divider"></div>
      <div class="section-body d-flex justify-content-center">
        <button id="hangman-start" class="btn btn-info btn-custom">Start a New Game</button>
      </div>
      <div class="divider"></div>
      <div id="hangman-gallows" class="text-center section-body"></div>
      <div id="hangman-status" class="text-center section-body"></div>
      <div id="hangman-wrong" class="text-center section-body"></div>
      <div id="hangman-input" class="justify-content-center input-group" hidden>
        <input id="hangman-guess" type='text' placeholder='Enter a letter'></input>
        <div class='input-group-append'>
          <button id='hangman-run' class='btn btn-info btn-custom'>Guess</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  $(document).ready(function() {
    $('#hangman-start').click(function() {
      // read dictionary doc and select a word
      $.ajax('hangman-dict/',
          {
            data: {
              csrfmiddlewaretoken: window.COOKIES.csrfmiddlewaretoken
            },
            type: 'GET',
          }
        )
        .done(function(data) {
          console.log(data);
          var current_word;
          current_word = data;
          startGame(current_word)
        })
        .fail(function(xhr, errmsg, err) {
           alert('There is an error.');
           console.log(xhr.status + ": " + xhr.responseText);
       });
    });

    function startGame(word) {
      // display initial gallows
      var gallows = ["   _____      <br>",
                     "  |     |     <br>",
                     "  |           <br>",
                     "  |           <br>",
                     "  |           <br>",
                     "  |           <br>",
                     " _|__         <br>",
                     "|    |______  <br>",
                     "|           | <br>",
                     "|___________| "];
      var gallowsHTML = "<div style='font-family: Courier New; line-height: normal;'>";
      for (var i = 0; i < gallows.length; i++) {
        gallows[i] = gallows[i].replaceAll(" ", "&#160;")
        gallowsHTML += gallows[i]
      };
      gallowsHTML += "</div>";
      $("#hangman-gallows").html(gallowsHTML);
      // display word length in "_" and show place for unsuccessful guesses
      var statusPrint = "<div style='font-family: Courier New; line-height: normal;'><br>";
      var letterDict = {};
      for (let i = 0; i < word.length; i++) {
        statusPrint += "_ ";
        if (!(word[i] in letterDict)) {
          letterDict[word[i]] = [i];
        }
        else {
          letterDict[word[i]].push(i)
        }
      var wrong = [];
      $("#hangman-status").html(statusPrint + "</div>");
      $("#hangman-wrong").html("<div style='font-family: Courier New; line-height: normal;'>Wrong guesses: [" + wrong + " ]</div>");
      };
      // display input section/button
      $("#hangman-input").removeAttr('hidden');;
    };

    $("#hangman-run").click(function() {
      var userInput = $("#hangman-guess").val().trim();
      console.log(userInput)
      $('#hangman-guess').val('');

      // var bodyComp = ["o", "|", "\\", "/", "/", "\\"];
      // var body = [" ", " ", " ", " ", " ", " "];
      // var penalty = 0;
      // var gallows = ["   _____      <br>",
      //                "  |     |     <br>",
      //                "  |    " + body[0] + "      <br>",
      //                "  |   " + body[2] + body[1] + body[3] + "   <br>",
      //                "  |    " + body[1] + "      <br>",
      //                "  |   " + body[4] + " " + body[5] + "   <br>",
      //                " _|__         <br>",
      //                "|    |______  <br>",
      //                "|           | <br>",
      //                "|___________| "];
      // var gallowsHTML = "<div style='font-family: Courier New; line-height: normal;'>";
      // for (let i = 0; i < gallows.length; i++) {
      //   gallows[i] = gallows[i].replaceAll(" ", "&#160;")
      //   gallowsHTML += gallows[i]
      // };
      // gallowsHTML += "</div>";
      // $("#hangman-gallows").html(gallowsHTML);
      // $("#hangman-status").html(statusPrint);
      // $("#hangman-wrong").html("Wrong guesses: [" + wrong + " ]");
    });

    function endGame() {
      $("#hangman-input").hide();
    };

    // hit enter to submit guess
    var input = document.getElementById("hangman-guess")
    input.addEventListener("keyup", function(event) {
      if (event.keyCode === 13) {
       event.preventDefault();
       document.getElementById("hangman-run").click();
      };
    });
  });
</script>
